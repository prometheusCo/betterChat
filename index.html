<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BetterChat Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500&family=Inter:wght@300;400;500&display=swap');
        
        :root {
            /* Default Dark Mode Tones */
            --bg-outer: #1e1e20; 
            --bg-inner: #0e0e0f; 
            --input-bg: #1e1f20;
            --text-main: #e3e3e3;
            --text-sub: #b4b4b4;
            --user-msg-bg: #2b2c2e;
            --border-color: #2d2e30;
            --shadow-style: 0 4px 12px rgba(0, 0, 0, 0.2);
            --modal-bg: #1e1f20;
        }

        :root.light-mode {
            /* Light Mode Tones */
            --bg-outer: #f0f2f5; 
            --bg-inner: #ffffff; 
            --input-bg: #f0f2f5;
            --text-main: #1f1f1f;
            --text-sub: #474747;
            --user-msg-bg: #e9eef6;
            --border-color: #e3e3e3;
            --shadow-style: 0 2px 8px rgba(0, 0, 0, 0.08);
            --modal-bg: #ffffff;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-outer);
            color: var(--text-main);
            transition: background-color 0.3s ease;
        }

        h1 {
            font-family: 'Google Sans', sans-serif;
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        
        .workspace {
            background-color: var(--bg-inner);
            border-radius: 28px;
            box-shadow: var(--shadow-style);
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }

        .message-content {
            line-height: 1.75;
            letter-spacing: 0.01em;
        }

        .input-pill {
            background-color: var(--input-bg);
            border-radius: 32px;
            border: 1px solid var(--border-color);
            transition: background-color 0.3s ease;
        }

        .user-msg {
            background-color: var(--user-msg-bg);
            transition: background-color 0.3s ease;
        }

        /* Modal Overlay */
        #modal-overlay {
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 50;
        }

        .modal-content {
            background-color: var(--modal-bg);
            border: 1px solid var(--border-color);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            display: flex;
            flex-direction: column;
        }

        .setting-input {
            width: 100%;
            padding: 10px 14px;
            border-radius: 12px;
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            color: var(--text-main);
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
        }
        
        .setting-input:focus {
            border-color: #3b82f6;
        }

        .fade-in-up {
            animation: fadeInUp 0.4s ease-out forwards;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body class="flex flex-col h-screen overflow-hidden">

    <!-- Header -->
    <header class="flex justify-end p-5 shrink-0 bg-[var(--bg-outer)] space-x-2 transition-colors duration-300">
        <button id="theme-toggle" class="p-2 rounded-full hover:bg-black/10 dark:hover:bg-white/5 transition-colors text-gray-400 hover:text-[var(--text-main)]" title="Toggle Theme">
            <svg id="sun-icon" class="hidden" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
            <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>
        </button>

        <button id="settings-btn" class="p-2 rounded-full hover:bg-black/10 dark:hover:bg-white/5 transition-colors text-gray-400 hover:text-[var(--text-main)]" title="Configuration & Memory">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
        </button>
    </header>

    <!-- Settings Modal -->
    <div id="modal-overlay" class="fixed inset-0 hidden flex items-center justify-center p-4">
        <div class="modal-content w-full max-w-lg rounded-[28px] overflow-hidden max-h-[90vh]">
            <!-- Fixed Header -->
            <div class="flex justify-between items-center p-6 border-b border-[var(--border-color)] bg-[var(--modal-bg)] shrink-0">
                <h2 class="text-xl font-medium">Settings</h2>
                <div class="flex items-center space-x-2">
                    <button id="cancel-modal" class="px-4 py-2 rounded-full text-sm font-medium text-[var(--text-sub)] hover:bg-black/5 dark:hover:bg-white/5 transition-colors">Cancel</button>
                    <button id="save-settings" class="px-5 py-2 rounded-full text-sm font-medium bg-blue-600 text-white hover:bg-blue-700 transition-colors shadow-lg shadow-blue-900/20">Save</button>
                    <button id="close-modal" class="ml-2 text-gray-500 hover:text-[var(--text-main)] p-1">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                    </button>
                </div>
            </div>

            <!-- Scrollable Content -->
            <div class="p-8 space-y-6 overflow-y-auto no-scrollbar">
                <!-- AI Configuration Section -->
                <div class="space-y-4">
                    <div class="grid grid-cols-1 gap-3">
                        <div>
                            <label class="text-xs text-[var(--text-sub)] mb-1 block">Model Name</label>
                            <input id="model-name" type="text" class="setting-input" placeholder="e.g. gpt-4o, gemini-pro">
                        </div>
                        <div>
                            <label class="text-xs text-[var(--text-sub)] mb-1 block">Endpoint URL</label>
                            <input id="endpoint-url" type="text" class="setting-input" placeholder="https://api.openai.com/v1/chat/completions">
                        </div>
                        <div>
                            <label class="text-xs text-[var(--text-sub)] mb-1 block">API Key</label>
                            <input id="api-key" type="password" class="setting-input" placeholder="sk-...">
                        </div>
                    </div>
                </div>

                <hr class="border-[var(--border-color)]">

                <!-- Memory Section -->
                <div class="space-y-3">
                    <h3 class="text-sm font-semibold uppercase tracking-wider text-gray-500">AI Memory</h3>
                    <p class="text-xs text-[var(--text-sub)]">Context information to remember across sessions.</p>
                    <textarea 
                        id="memory-input" 
                        class="w-full h-40 p-3 rounded-xl bg-[var(--input-bg)] border border-[var(--border-color)] text-[var(--text-main)] text-sm focus:ring-1 focus:ring-blue-500 outline-none resize-none"
                        placeholder="Example: My name is Alex and I'm a frontend developer..."></textarea>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Workspace -->
    <div class="flex-1 flex items-center justify-center px-4 sm:px-6 bg-[var(--bg-outer)] overflow-hidden pb-4 transition-colors duration-300">
        <main id="workspace-container" class="workspace w-full max-w-4xl flex flex-col relative overflow-hidden h-full">
            <div id="chat-area" class="flex-1 overflow-y-auto no-scrollbar flex flex-col items-center">
                <!-- Hero State -->
                <div id="hero" class="my-auto flex flex-col items-center text-center px-6">
                    <h1 class="text-4xl md:text-5xl font-medium bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent mb-4">
                        BetterChat
                    </h1>
                    <p class="text-[var(--text-sub)] text-lg max-w-md">Your usual AI, but significantly smarter.</p>
                </div>

                <!-- Message List -->
                <div id="message-list" class="w-full max-w-3xl px-6 space-y-10 py-12 hidden"></div>
            </div>

            <!-- Input Bar -->
            <div class="w-full flex justify-center pb-8 pt-4 px-6 shrink-0">
                <div class="w-full max-w-3xl relative">
                    <div class="input-pill flex items-end p-2 pl-6 pr-3 transition-all">
                        <textarea 
                            id="user-input"
                            rows="1"
                            placeholder="Enter a prompt here"
                            class="w-full bg-transparent border-none focus:ring-0 outline-none py-3 text-[16px] text-[var(--text-main)] placeholder-gray-500 max-h-[200px] overflow-y-auto no-scrollbar"
                        ></textarea>
                        
                        <div class="flex items-center space-x-1 mb-1">
                            <button id="send-button" class="p-3 text-gray-400 hover:text-[var(--text-main)] transition-all disabled:opacity-0" disabled>
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m5 12 7-7 7 7"/><path d="M12 19V5"/></svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Updated Footer -->
    <footer class="w-full flex flex-col items-center pb-3 pt-2 px-4 shrink-0 bg-[var(--bg-outer)] transition-colors duration-300">
        <div class="flex items-center space-x-2 text-[11px] text-gray-500">
            <span>BetterChat</span>
            <span class="opacity-30">|</span>
            <span>&copy; <a href="https://japgcv.es" target="_blank" class="hover:text-blue-400 transition-colors">japgcv.es</a></span>
        </div>
    </footer>

    <script>
        // DOM Elements
        const input = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-button');
        const messageList = document.getElementById('message-list');
        const hero = document.getElementById('hero');
        const chatArea = document.getElementById('chat-area');
        const themeToggle = document.getElementById('theme-toggle');
        const sunIcon = document.getElementById('sun-icon');
        const moonIcon = document.getElementById('moon-icon');
        
        // Modal Elements
        const settingsBtn = document.getElementById('settings-btn');
        const modalOverlay = document.getElementById('modal-overlay');
        const closeModal = document.getElementById('close-modal');
        const cancelModal = document.getElementById('cancel-modal');
        const saveSettingsBtn = document.getElementById('save-settings');
        
        // Form Fields
        const memoryInput = document.getElementById('memory-input');
        const modelNameInput = document.getElementById('model-name');
        const endpointUrlInput = document.getElementById('endpoint-url');
        const apiKeyInput = document.getElementById('api-key');

        // Logic for Persistent State
        let config = {
            memory: localStorage.getItem('ai_memory') || '',
            model: localStorage.getItem('ai_model_name') || '',
            endpoint: localStorage.getItem('ai_endpoint') || '',
            apiKey: localStorage.getItem('ai_api_key') || ''
        };
        
        let chatHistory = JSON.parse(localStorage.getItem('chat_history')) || [];
        
        // Set initial form values
        memoryInput.value = config.memory;
        modelNameInput.value = config.model;
        endpointUrlInput.value = config.endpoint;
        apiKeyInput.value = config.apiKey;

        // Initialize Chat on Load
        window.onload = () => {
            if (chatHistory.length > 0) {
                chatHistory.forEach(msg => appendToUI(msg.content, msg.role, false));
            }
        };

        // Theme Toggle Logic
        themeToggle.addEventListener('click', () => {
            const isLight = document.documentElement.classList.toggle('light-mode');
            if (isLight) {
                sunIcon.classList.remove('hidden');
                moonIcon.classList.add('hidden');
            } else {
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
            }
        });

        // Modal Logic
        const toggleModal = (show) => {
            modalOverlay.classList.toggle('hidden', !show);
        };

        settingsBtn.addEventListener('click', () => toggleModal(true));
        closeModal.addEventListener('click', () => toggleModal(false));
        cancelModal.addEventListener('click', () => toggleModal(false));
        modalOverlay.addEventListener('click', (e) => {
            if (e.target === modalOverlay) toggleModal(false);
        });

        saveSettingsBtn.addEventListener('click', () => {
            // Update local config object
            config.memory = memoryInput.value.trim();
            config.model = modelNameInput.value.trim();
            config.endpoint = endpointUrlInput.value.trim();
            config.apiKey = apiKeyInput.value.trim();

            // Persist to localStorage
            localStorage.setItem('ai_memory', config.memory);
            localStorage.setItem('ai_model_name', config.model);
            localStorage.setItem('ai_endpoint', config.endpoint);
            localStorage.setItem('ai_api_key', config.apiKey);

            toggleModal(false);
            
            showFeedback("Settings saved successfully");
        });

        function showFeedback(text) {
            const feedback = document.createElement('div');
            feedback.className = "fixed bottom-10 left-1/2 -translate-x-1/2 bg-blue-600 text-white px-6 py-2 rounded-full text-sm shadow-lg fade-in-up z-50";
            feedback.textContent = text;
            document.body.appendChild(feedback);
            setTimeout(() => feedback.remove(), 2500);
        }

        // Input Handling
        input.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = this.scrollHeight + 'px';
            sendBtn.disabled = this.value.trim().length === 0;
        });

        function appendToUI(content, role, animate = true) {
            if (!hero.classList.contains('hidden')) {
                hero.classList.add('hidden');
                messageList.classList.remove('hidden');
            }

            const wrapper = document.createElement('div');
            wrapper.className = `flex w-full ${animate ? 'fade-in-up' : ''} ${role === 'user' ? 'justify-end' : 'justify-start'}`;
            
            const message = document.createElement('div');
            if (role === 'user') {
                message.className = 'user-msg px-5 py-3 rounded-3xl text-[15px] max-w-[80%]';
                message.textContent = content;
            } else {
                message.className = 'flex space-x-4 w-full';
                message.innerHTML = `
                    <div class="shrink-0 mt-1">
                        <div class="w-8 h-8 rounded-full bg-gradient-to-tr from-blue-500 to-purple-500 flex items-center justify-center">
                            <svg class="text-white" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L14.5 9.5L22 12L14.5 14.5L12 22L9.5 14.5L2 12L9.5 9.5L12 2Z"/></svg>
                        </div>
                    </div>
                    <div class="message-content text-[16px] text-[var(--text-main)] pt-1">
                        ${content}
                    </div>
                `;
            }
            
            wrapper.appendChild(message);
            messageList.appendChild(wrapper);
            chatArea.scrollTo({ top: chatArea.scrollHeight, behavior: animate ? 'smooth' : 'auto' });
        }

        function saveMessage(content, role) {
            chatHistory.push({ content, role });
            localStorage.setItem('chat_history', JSON.stringify(chatHistory));
        }

        function handleSend() {
            const text = input.value.trim();
            if (!text) return;

            appendToUI(text, 'user');
            saveMessage(text, 'user');

            input.value = '';
            input.style.height = 'auto';
            sendBtn.disabled = true;

            // Simulated AI Response using config
            setTimeout(() => {
                let response = `Request processed`;
                if (config.model) {
                    response += ` by model: ${config.model}.`;
                } else {
                    response += ".";
                }

                if (config.memory) {
                    response += " Personalized using memory context.";
                }
                
                appendToUI(response, 'assistant');
                saveMessage(response, 'assistant');
            }, 600);
        }

        sendBtn.addEventListener('click', handleSend);
        input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                handleSend();
            }
        });
    </script>
</body>
</html>